# Fichero de configuraci칩n para los contenedores del servidor de la aplicaci칩n Agenda
version: "3.7"
services:

  # Contenedor para la persistencia de datos
  agenda-db:
    # La imagen del contenedor est치 preparada en dockerhub
    build: ./database
    # Nombre asignado al contenedor
    container_name: agenda-db
    # Red para el conjunto de contenedores
    ports:
      - 3306:3306
    #La ruta del volumen debe apuntar a la carpeta que contiene los datos de la base de datos
    volumes:
      - database-agenda:/var/lib/mysql
    #Variables de entorno  para el contenedor
    env_file:
      - .env.example
    networks:
      - agenda-server
    depends_on:
        - agenda-serverproxy

 # Contenedor para el servidor laravel
  agenda-server:
    # La imagen del contenedor se construye sobre una adecuando las necesidades
    build: .
    # Nombre asignado al contenedor
    container_name: agenda-server
    # Variable de entorno para el contendor
    environment:
      # Esta ruta debe estar incluida en el fichero hosts del anfitri칩n
      VIRTUAL_HOST: agenda.server.local
    depends_on:
        - agenda-db
        - agenda-serverproxy
    networks:
        - agenda-server
    # Se mapea la carpeta con una local
    volumes:
        - .:/var/www/html/
    # restart: always

networks:
    agenda-server:
        driver: bridge
volumes:
    database-agenda:
